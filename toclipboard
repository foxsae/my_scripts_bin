#!/bin/bash
# toclipboard - copy a fileâ€™s contents or path to the clipboard

usage() {
  echo "Usage: toclipboard [-p] <filename>"
  echo
  echo "Options:"
  echo "  -p    Copy the file's path instead of its contents"
  exit 1
}

if [ $# -eq 0 ]; then
  usage
fi

COPY_PATH=false

# Check for -p option
if [ "$1" = "-p" ]; then
  COPY_PATH=true
  shift
fi

FILE="$1"

if [ -z "$FILE" ]; then
  usage
fi

if [ ! -f "$FILE" ] && [ "$COPY_PATH" = false ]; then
  echo "Error: file '$FILE' not found."
  exit 1
fi

# Clipboard copy function (Wayland or X11)
copy_to_clipboard() {
  if [ -n "$WAYLAND_DISPLAY" ] && command -v wl-copy >/dev/null 2>&1; then
    wl-copy
  elif command -v xclip >/dev/null 2>&1; then
    xclip -selection clipboard
  else
    echo "Error: no clipboard tool (xclip or wl-clipboard) installed."
    exit 1
  fi
}

if [ "$COPY_PATH" = true ]; then
  # Copy the path
  echo "$(realpath "$FILE")" | copy_to_clipboard
  echo "Copied file path to clipboard: $(realpath "$FILE")"
else
  # Copy the contents
  cat "$FILE" | copy_to_clipboard
  echo "Copied contents of '$FILE' to clipboard."
fi
